<#@ template language="C#" #>
<#@ output extension=".cs" #>
<#@ parameter type="System.Int32" name="MaxCount" #>
// <auto-generated />
namespace Macaron.Functional;

partial class EitherExtensions
{
    public static Either<TLeft, TResult> Apply<TLeft, TRight, TResult>(
        this Either<TLeft, Func<TRight, TResult>> fn,
        Either<TLeft, TRight> either
    )
    {
        if (fn.IsLeft)
        {
            return Either.Left<TLeft, TResult>(fn.Left);
        }

        if (either.IsLeft)
        {
            return Either.Left<TLeft, TResult>(either.Left);
        }

        var f = fn.Right;
        var value1 = either.Right;
        var result = f(value1);

        return Either.Right<TLeft, TResult>(result);
    }

<# for (var i = 2; i <= MaxCount; i++) { #>
    public static Either<TLeft, TResult> Apply<TLeft, <# for (var j = 1; j <= i; j++) { #>TRight<#= j #>, <# } #>TResult>(
        this Either<TLeft, Func<<# for (var j = 1; j <= i; j++) { #>TRight<#= j #>, <# } #>TResult>> fn,
<# for (var j = 1; j < i; j++) { #>
        Either<TLeft, TRight<#= j #>> either<#= j #>,
<# } #>
        Either<TLeft, TRight<#= i #>> either<#= i #>
    )
    {
        if (fn.IsLeft)
        {
            return Either.Left<TLeft, TResult>(fn.Left);
        }

<# for (var j = 1; j <= i; j++) { #>
        if (either<#= j #>.IsLeft)
        {
            return Either.Left<TLeft, TResult>(either<#= j #>.Left);
        }

<# } #>
        var f = fn.Right;
<# for (var j = 1; j <= i; j++) { #>
        var value<#= j #> = either<#= j #>.Right;
<# } #>
        var result = f(<# for (var j = 1; j <= i; j++) { #>value<#= j #><# if (j < i) { #>, <# } #><# } #>);

        return Either.Right<TLeft, TResult>(result);
    }

<# } #>
}